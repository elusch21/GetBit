<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Account</title>
    <style>
        p {
            font-size: 20px;
            color: black;
        }
        .column1 {
            float: left;
            width: 50%;
        }
        .column2 {
            float: right;
             width: 50%;
        }
    </style>
</head>
<body>
<!--Standard Nav Bar -->
    <div class="nav">
        <a href="index.html">Homepage</a>
        <a href="documentation.html">Documentations</a>
        <div class="dropdown">
            <button class="dropbtn">Account</button>
            <div class="dropdown-content">
                <a href="Login.html">Login</a>
                <a href="SignUp.html">Sign Up</a>
            </div>
        </div>
        <a href="contact.html">Contact Us</a>
    </div>
    <div class="column1">
        <h1>Welcome Back, USER</h1>
        <h3 id="date"></h3>
<!-- BitCoin Table -->
        <table class="bitcoin-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Symbol</th>
                    <th>Last Price</th>
                    <th>24h Change</th>
                    <th>Rank</th>     
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="name0"></td>
                    <td id="sym0"></td>
                    <td id="price0"></td>
                    <td id="change0"></td>
                    <td id="rank0"></td>
                </tr>
                <tr>
                    <td id="name1"></td>
                    <td id="sym1"></td>
                    <td id="price1"></td>
                    <td id="change1"></td>
                    <td id="rank1"></td>
                </tr>
                <tr>
                    <td id="name2"></td>
                    <td id="sym2"></td>
                    <td id="price2"></td>
                    <td id="change2"></td>
                    <td id="rank2"></td>
                </tr>
                <tr>
                    <td id="name3"></td>
                    <td id="sym3"></td>
                    <td id="price3"></td>
                    <td id="change3"></td>
                    <td id="rank3"></td>
                </tr>
                <tr>
                    <td id="name4"></td>
                    <td id="sym4"></td>
                    <td id="price4"></td>
                    <td id="change4"></td>
                    <td id="rank4"></td>
                </tr>
                <tr>
                    <td id="name5"></td>
                    <td id="sym5"></td>
                    <td id="price5"></td>
                    <td id="change5"></td>
                    <td id="rank5"></td>
                </tr>
                <tr>
                    <td id="name6"></td>
                    <td id="sym6"></td>
                    <td id="price6"></td>
                    <td id="change6"></td>
                    <td id="rank6"></td>
                </tr>
                <tr>
                    <td id="name7"></td>
                    <td id="sym7"></td>
                    <td id="price7"></td>
                    <td id="change7"></td>
                    <td id="rank7"></td>
                </tr>
            </tbody>
        </table>
    </div>
<!-- Insert Coin Form -->
    <div class="column2">
        <div class="account-pages">
            <div class="form">
                <form>
                    <p style="color: white;">Add a coin to keep track of</p>
                    <input type="text" name="coin" placeholder="eg. BTC"/>
                    <input type="button" onclick="submit()" value='ADD'>
                </form>
            </div>
        </div>
        <div class="account-pages">
            <div class="form">
                <form>
                    <p style="color: white;">Delete coin from tracking</p>
                    <input type="text" name="coin" placeholder="eg. BTC"/>
                    <input type="button" onclick="submit()" value='REMOVE'>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        function submit() {
            // if symbol is found from API, add it to user mongo
            // else alert "coin not found"
        }
        var date = new Date();
        var month = date.getMonth() + 1;
        var day = date.getDate();
        var year = date.getFullYear();

        var message = "Your Coins as of " + month + "/" + day + "/" + year;
        document.getElementById("date").innerHTML = message;
    
        
        function makeCall(val) {
            request = new XMLHttpRequest();

            // concatenate the url to make the api call
            // parameter val will be an array of BitCoins and
            // will be added to the url and separated by commas
            var apiString = "https://api.coinranking.com/v1/public/coins?base=USD&symbols=";
            for(i=0; i<val.length; i++) {
                apiString += val[i];
                if(i != val.length-1)
                    apiString += ",";  
            }
            apiString += "&timePeriod=24h";
            request.open("GET", apiString, true);

            request.onreadystatechange = function() {
                if (request.readyState == 4 && request.status == 200) {
                    var result = request.responseText;
                    var obj = JSON.parse(result);
                    /*
                    var str = "Name: " + obj.data.coins[0].name + "\n" 
                            + "Symbol: " + obj.data.coins[0].symbol + "\n" 
                            + "Last Price (USD): $" + parseFloat(obj.data.coins[0].price).toFixed(2) 
                            + "\n" + "24h Change: $" + parseFloat(obj.data.coins[0].change)
                            + "\n" + "Rank: " + parseFloat(obj.data.coins[0].rank);

                    alert(str);
                    */

                    for(j=0; j<val.length; j++) {
                        document.getElementById("name"+j).innerHTML = obj.data.coins[j].name;
                        document.getElementById("sym"+j).innerHTML = obj.data.coins[j].symbol;
                        var temp = "$" + parseFloat(obj.data.coins[j].price).toFixed(2);
                        document.getElementById("price"+j).innerHTML = temp;
                        document.getElementById("change"+j).innerHTML = obj.data.coins[j].change + "%";
                        document.getElementById("rank"+j).innerHTML = obj.data.coins[j].rank;

                        //if(parseFloat(obj.data.coins[j].change) > 0) {
                        //    document.getElementById("change"+j).style.color = "#32CD32";
                        //}
                    }
                    for(k=val.length; k<8; k++) {
                        document.getElementById("name"+k).innerHTML = "empty";
                        document.getElementById("sym"+k).innerHTML = "empty";
                        document.getElementById("price"+k).innerHTML = "empty";
                        document.getElementById("change"+k).innerHTML = "empty";
                        document.getElementById("rank"+k).innerHTML = "empty"; 
                    } 

                } else if (request.readyState == 4) {
                    //failed request, handle it
                } else if (request.readyState == 3) {
                    //incomplete request, handle it
                    document.getElementById("data").innerHTML = "Request Processing...";
                }
            }
            request.send();
        }

        var tempArr1 = new Array();
        tempArr1.push('TRX');
        tempArr1.push('BTC');
        tempArr1.push('BCH');

        makeCall(tempArr1);

        // getting rid of one 
        var tempArr2 = new Array();
        tempArr2.push('TRX');
        tempArr2.push('BTC');

        // whole new set
        var tempArr3 = new Array();
        tempArr3.push('ADA');
        tempArr3.push('PAX');
        tempArr3.push('LINK');
    </script>
    <button onclick="makeCall(tempArr2)">Delete BCH</button>
    <button onclick="makeCall(tempArr3)">New Set</button>
</body>
</html>